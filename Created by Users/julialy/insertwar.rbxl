<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="Workspace" referent="RBX0">
		<Properties>
			<Ref name="CurrentCamera">RBX1</Ref>
			<double name="DistributedGameTime">0</double>
			<CoordinateFrame name="ModelInPrimary">
				<X>0</X>
				<Y>0</Y>
				<Z>0</Z>
				<R00>1</R00>
				<R01>0</R01>
				<R02>0</R02>
				<R10>0</R10>
				<R11>1</R11>
				<R12>0</R12>
				<R20>0</R20>
				<R21>0</R21>
				<R22>1</R22>
			</CoordinateFrame>
			<string name="Name">Workspace</string>
			<Ref name="PrimaryPart">null</Ref>
			<bool name="archivable">true</bool>
		</Properties>
		<Item class="Camera" referent="RBX1">
			<Properties>
				<Ref name="CameraSubject">null</Ref>
				<token name="CameraType">0</token>
				<CoordinateFrame name="CoordinateFrame">
					<X>-270.324829</X>
					<Y>379.934204</Y>
					<Z>-621.965942</Z>
					<R00>-0.91685164</R00>
					<R01>0.194141984</R01>
					<R02>-0.348843604</R02>
					<R10>-1.49011594e-008</R10>
					<R11>0.87379545</R11>
					<R12>0.486293644</R12>
					<R20>0.399227917</R20>
					<R21>0.445859134</R21>
					<R22>-0.801140904</R22>
				</CoordinateFrame>
				<CoordinateFrame name="Focus">
					<X>0.5</X>
					<Y>2.4000001</Y>
					<Z>0</Z>
					<R00>1</R00>
					<R01>0</R01>
					<R02>0</R02>
					<R10>0</R10>
					<R11>1</R11>
					<R12>0</R12>
					<R20>0</R20>
					<R21>0</R21>
					<R22>1</R22>
				</CoordinateFrame>
				<string name="Name">Camera</string>
				<bool name="archivable">true</bool>
			</Properties>
		</Item>
		<Item class="Script" referent="RBX2">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">clean</string>
				<ProtectedString name="Source">function onChatted(msg, recipient, speaker)	-- convert to all lower case	local source = string.lower(speaker.Name)	msg = string.lower(msg)--------------------------------------command between these bits--------------------------------------	if (msg == &quot;clear&quot;) then	cf = game.Workspace:GetChildren()		for i = 1, #cf do			if cf[i].Name == &quot;Part&quot; then				cf[i]:remove()			end 		end
	end--- change bricks to the name of the bricks (you can clone this script for each type of brick (with different or same command)
--- also you can change &apos;clean up&apos; to something (if you change it to code and dont tell ppl it they wont be able to say it :P )












--------------------------------------command between these bits--------------------------------------
end

function onPlayerEntered(newPlayer)	newPlayer.Chatted:connect(function(msg, recipient) onChatted(msg, recipient, newPlayer) end) endgame.Players.ChildAdded:connect(onPlayerEntered)</ProtectedString>
				<bool name="archivable">true</bool>
			</Properties>
		</Item>
		<Item class="Script" referent="RBX3">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">clean</string>
				<ProtectedString name="Source">function onChatted(msg, recipient, speaker)	-- convert to all lower case	local source = string.lower(speaker.Name)	msg = string.lower(msg)--------------------------------------command between these bits--------------------------------------	if (msg == &quot;clear&quot;) then	cf = game.Workspace:GetChildren()		for i = 1, #cf do			if cf[i].Name == &quot;Smooth Block Model&quot; then				cf[i]:remove()			end 		end
	end--- change bricks to the name of the bricks (you can clone this script for each type of brick (with different or same command)
--- also you can change &apos;clean up&apos; to something (if you change it to code and dont tell ppl it they wont be able to say it :P )












--------------------------------------command between these bits--------------------------------------
end

function onPlayerEntered(newPlayer)	newPlayer.Chatted:connect(function(msg, recipient) onChatted(msg, recipient, newPlayer) end) endgame.Players.ChildAdded:connect(onPlayerEntered)</ProtectedString>
				<bool name="archivable">true</bool>
			</Properties>
		</Item>
		<Item class="Script" referent="RBX4">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">clean</string>
				<ProtectedString name="Source">function onChatted(msg, recipient, speaker)	-- convert to all lower case	local source = string.lower(speaker.Name)	msg = string.lower(msg)--------------------------------------command between these bits--------------------------------------	if (msg == &quot;clear&quot;) then	cf = game.Workspace:GetChildren()		for i = 1, #cf do			if cf[i].Name == &quot;Truss&quot; then				cf[i]:remove()			end 		end
	end--- change bricks to the name of the bricks (you can clone this script for each type of brick (with different or same command)
--- also you can change &apos;clean up&apos; to something (if you change it to code and dont tell ppl it they wont be able to say it :P )












--------------------------------------command between these bits--------------------------------------
end

function onPlayerEntered(newPlayer)	newPlayer.Chatted:connect(function(msg, recipient) onChatted(msg, recipient, newPlayer) end) endgame.Players.ChildAdded:connect(onPlayerEntered)</ProtectedString>
				<bool name="archivable">true</bool>
			</Properties>
		</Item>
		<Item class="Script" referent="RBX5">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">clean</string>
				<ProtectedString name="Source">function onChatted(msg, recipient, speaker)	-- convert to all lower case	local source = string.lower(speaker.Name)	msg = string.lower(msg)--------------------------------------command between these bits--------------------------------------	if (msg == &quot;clear&quot;) then	cf = game.Workspace:GetChildren()		for i = 1, #cf do			if cf[i].Name == &quot;Wedge&quot; then				cf[i]:remove()			end 		end
	end--- change bricks to the name of the bricks (you can clone this script for each type of brick (with different or same command)
--- also you can change &apos;clean up&apos; to something (if you change it to code and dont tell ppl it they wont be able to say it :P )












--------------------------------------command between these bits--------------------------------------
end

function onPlayerEntered(newPlayer)	newPlayer.Chatted:connect(function(msg, recipient) onChatted(msg, recipient, newPlayer) end) endgame.Players.ChildAdded:connect(onPlayerEntered)</ProtectedString>
				<bool name="archivable">true</bool>
			</Properties>
		</Item>
		<Item class="Script" referent="RBX6">
			<Properties>
				<bool name="Disabled">false</bool>
				<Content name="LinkedSource"><null></null></Content>
				<string name="Name">TalkyScript</string>
				<ProtectedString name="Source">door = script.Parent.Base --this is the door 

function onChatted(msg, recipient, speaker) 

-- convert to all lower case 

local source = string.lower(speaker.Name) 
msg = string.lower(msg) 

if (msg == &quot;clear&quot;) then 
door.CanCollide = false 
door.Transparency = 0.7 
wait(5) 
door.CanCollide = true 
door.Transparency = 0 
end 

end 

function onPlayerEntered(newPlayer) 
newPlayer.Chatted:connect(function(msg, recipient) onChatted(msg, recipient, newPlayer) end) 
end 

game.Players.ChildAdded:connect(onPlayerEntered) 
</ProtectedString>
				<bool name="archivable">true</bool>
			</Properties>
		</Item>
		<Item class="Part" referent="RBX7">
			<Properties>
				<bool name="Anchored">true</bool>
				<float name="BackParamA">-0.5</float>
				<float name="BackParamB">0.5</float>
				<token name="BackSurface">0</token>
				<token name="BackSurfaceInput">0</token>
				<float name="BottomParamA">-0.5</float>
				<float name="BottomParamB">0.5</float>
				<token name="BottomSurface">4</token>
				<token name="BottomSurfaceInput">0</token>
				<int name="BrickColor">37</int>
				<CoordinateFrame name="CFrame">
					<X>-0.400119305</X>
					<Y>1.00000215</Y>
					<Z>-0.5</Z>
					<R00>-4.37113847e-008</R00>
					<R01>-0.99999994</R01>
					<R02>-3.55271368e-015</R02>
					<R10>0.99999994</R10>
					<R11>-4.37113847e-008</R11>
					<R12>4.37113883e-008</R12>
					<R20>-4.37113847e-008</R20>
					<R21>0</R21>
					<R22>1</R22>
				</CoordinateFrame>
				<bool name="CanCollide">true</bool>
				<bool name="DraggingV1">false</bool>
				<float name="Elasticity">0.5</float>
				<token name="FormFactor">1</token>
				<float name="Friction">0.300000012</float>
				<float name="FrontParamA">-0.5</float>
				<float name="FrontParamB">0.5</float>
				<token name="FrontSurface">0</token>
				<token name="FrontSurfaceInput">0</token>
				<float name="LeftParamA">-0.5</float>
				<float name="LeftParamB">0.5</float>
				<token name="LeftSurface">0</token>
				<token name="LeftSurfaceInput">0</token>
				<bool name="Locked">false</bool>
				<token name="Material">1280</token>
				<string name="Name">Base</string>
				<float name="Reflectance">0.200000003</float>
				<float name="RightParamA">-0.5</float>
				<float name="RightParamB">0.5</float>
				<token name="RightSurface">0</token>
				<token name="RightSurfaceInput">0</token>
				<Vector3 name="RotVelocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<float name="TopParamA">-0.5</float>
				<float name="TopParamB">0.5</float>
				<token name="TopSurface">0</token>
				<token name="TopSurfaceInput">0</token>
				<float name="Transparency">0.100000001</float>
				<Vector3 name="Velocity">
					<X>0</X>
					<Y>0</Y>
					<Z>0</Z>
				</Vector3>
				<bool name="archivable">true</bool>
				<token name="shape">1</token>
				<Vector3 name="size">
					<X>2</X>
					<Y>2044.80005</Y>
					<Z>2048</Z>
				</Vector3>
			</Properties>
		</Item>
	</Item>
	<Item class="RunService" referent="RBX8">
		<Properties>
			<string name="Name">Run Service</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="ContentProvider" referent="RBX9">
		<Properties>
			<string name="Name">Instance</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="ContentFilter" referent="RBX10">
		<Properties>
			<string name="Name">ContentFilter</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="KeyframeSequenceProvider" referent="RBX11">
		<Properties>
			<string name="Name">Instance</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="Players" referent="RBX12">
		<Properties>
			<int name="MaxPlayers">12</int>
			<string name="Name">Players</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="StarterPack" referent="RBX13">
		<Properties>
			<string name="Name">StarterPack</string>
			<bool name="archivable">true</bool>
		</Properties>
		<Item class="Tool" referent="RBX14">
			<Properties>
				<bool name="Enabled">true</bool>
				<CoordinateFrame name="Grip">
					<X>0.600000024</X>
					<Y>0.200000003</Y>
					<Z>0</Z>
					<R00>0</R00>
					<R01>0</R01>
					<R02>1</R02>
					<R10>0</R10>
					<R11>1</R11>
					<R12>-0</R12>
					<R20>-1</R20>
					<R21>0</R21>
					<R22>0</R22>
				</CoordinateFrame>
				<string name="Name">Insert tool</string>
				<Content name="TextureId"><url>rbxasset://icons/insert.png</url></Content>
				<bool name="archivable">true</bool>
			</Properties>
			<Item class="LocalScript" referent="RBX15">
				<Properties>
					<bool name="Disabled">false</bool>
					<Content name="LinkedSource"><null></null></Content>
					<string name="Name">Insert Local</string>
					<ProtectedString name="Source">local Tool = script.Parent

--game:GetService(&quot;InsertService&quot;):SetCollectionUrl(&quot;http://test.roblox.com/Game/Tools/insertasset.ashx?sid=%d&quot;)
--game:GetService(&quot;InsertService&quot;):SetBaseCategoryUrl(&quot;http://test.roblox.com/Game/Tools/insertasset.ashx?nsets=10&quot;)
--game:GetService(&quot;InsertService&quot;):SetAssetUrl(&quot;http://test.roblox.com/Asset/?id=%d&quot;)
 
enabled = true
local origTexture = 	Tool.TextureId
game:GetService(&quot;ContentProvider&quot;):Preload(&quot;rbxasset://icons/insert_sel.png&quot;)

local height = 20
local width = UDim.new(0.25, 0)
local height = 20
local buttonTransparency = 0.1
local insertButtonTransparency = 0.25
local transparency = 0.25

local selectedButtonColor = Color3.new(.1255, .4078, .1961)
local selectedButtonTextColor = Color3.new(1.0,1.0,1.0)

local buttonColor = Color3.new(0.0898, 0.2148, .2344)
local buttonTextColor = Color3.new(1.0,1.0,1.0)

local frameColor = Color3.new(.1255, .4078, .1961)
local frameTextColor = Color3.new(1.0,1.0,1.0)

local titleColor = Color3.new(0.6289, 0.8398, 0)
local titleTextColor = Color3.new(0.0,0.0,0.0)

local Window
local Data
local Mouse

local SetCache = {}

local soloGame = game:FindFirstChild(&quot;NetworkClient&quot;) == nil

--Constants
local useAssetVersionId = true
local BaseUrl = game:GetService(&quot;ContentProvider&quot;).BaseUrl
local ThumbnailUrl;
if useAssetVersionId then
	ThumbnailUrl = BaseUrl .. &quot;Game/Tools/ThumbnailAsset.ashx?fmt=png&amp;wd=110&amp;ht=110&amp;assetversionid=&quot;
else
	ThumbnailUrl = BaseUrl .. &quot;Game/Tools/ThumbnailAsset.ashx?fmt=png&amp;wd=110&amp;ht=110&amp;aid=&quot;
end

local InsertRows = 4
local InsertColumns = 8

--Static variables used for creating sizes
function getPlayer()
	local character = script.Parent.Parent
	return game.Players:GetPlayerFromCharacter(character)
end

function minimize()
	if Window.Stamp.Frame.Visible then
		cancelAssetPlacement()
	elseif Window.Main.Frame.Visible then
		Window.Main.Frame.Visible = false
		Window.Minimized.Frame.Visible = true
	end
end

function buildImageButton(image)
	local buttonFrame = Instance.new(&quot;Frame&quot;)
	buttonFrame.BackgroundTransparency = 1.0

	local button = Instance.new(&quot;ImageButton&quot;)
	button.Name = &quot;Button&quot;
	button.Parent  = buttonFrame
	button.Image = image
	button.Size = UDim2.new(1.0, 0, 1.0, 0)
	button.Position = UDim2.new(0.0, 0, 0.0, 0)
	button.BorderSizePixel = 1
	button.Parent  = buttonFrame
	button.BackgroundTransparency = 0
	
	return buttonFrame

end
function buildTextButton(text)

	local buttonFrame = Instance.new(&quot;Frame&quot;)
	buttonFrame.BackgroundTransparency = 1.0
	local button = Instance.new(&quot;TextButton&quot;)
	button.Name = &quot;Button&quot;
	button.Parent  = buttonFrame
	button.Text = text
	button.Size = UDim2.new(1.0, 0, 1.0, 0)
	button.TextWrap = true
	button.Position = UDim2.new(0.0, 0, 0.0, 0)
	button.BorderSizePixel = 1
	button.BackgroundTransparency = buttonTransparency
	button.Parent  = buttonFrame
	
	return buttonFrame
end

function mouseEnterInsertButton(insertFrame)
	if insertFrame ~= Data.CurrentRolloverInsertButton then
		insertFrame.Button.Transparency = 0.0
		Data.CurrentRolloverInsertButton = insertFrame
		Window.Main.RolloverText.Text = Data.CurrentRolloverInsertButton.AssetName.Value
	end
end

function mouseLeaveInsertButton(insertFrame)
	if insertFrame == Data.CurrentRolloverInsertButton then
		Window.Main.RolloverText.Text = &quot;&quot;
		Data.CurrentRolloverInsertButton = nil
		
	end
	insertFrame.Button.Transparency = insertButtonTransparency
end

function buildInsertButton(position, size)
	local insertFrame = buildImageButton(&quot;&quot;)
	insertFrame.Name = &quot;InsertAssetButton&quot;
	insertFrame.Position = position
	insertFrame.Size = size
	insertFrame.Button.BackgroundColor3 = Color3.new(1.0,1.0,1.0)
	insertFrame.Button.Transparency = insertButtonTransparency
	insertFrame.Visible = false

	local assetId = Instance.new(&quot;IntValue&quot;)
	assetId.Name = &quot;AssetId&quot;
	assetId.Value = -1
	assetId.Parent = insertFrame

	local assetName = Instance.new(&quot;StringValue&quot;)
	assetName.Name = &quot;AssetName&quot;
	assetName.Value = &quot;&quot;
	assetName.Parent = insertFrame

	insertFrame.Button.MouseButton1Click:connect(function() mouseLeaveInsertButton(insertFrame) beginInsertAsset(insertFrame.AssetName.Value, insertFrame.AssetId.Value, insertFrame.Button.Image, false) end)
	insertFrame.Button.MouseButton2Click:connect(function() mouseLeaveInsertButton(insertFrame) beginInsertAsset(insertFrame.AssetName.Value, insertFrame.AssetId.Value, insertFrame.Button.Image, true) end)
	insertFrame.Button.MouseEnter:connect(function() mouseEnterInsertButton(insertFrame) end)
	insertFrame.Button.MouseLeave:connect(function() mouseLeaveInsertButton(insertFrame) end)

	return insertFrame
end

function setInsertButtonImageBehavior(insertFrame, visible, name, assetId)
	if visible then
		insertFrame.AssetName.Value = name
		insertFrame.AssetId.Value = assetId
		insertFrame.Button.Image = ThumbnailUrl  .. assetId
		insertFrame.Button.BackgroundColor3 = Color3.new(1.0,1.0,1.0)
		insertFrame.Visible = true
	else
		insertFrame.Visible = false
	end		
end

function mouseEnterSetButton(setFrame)
	if setFrame.Button.AutoButtonColor then
		setFrame.Button.Icon.Transparency = 0.0
	end
end
function mouseLeaveSetButton(setFrame)
	if setFrame.Button.AutoButtonColor then
		setFrame.Button.Icon.Transparency = insertButtonTransparency
	end
end

function buildSetButton(name, setId, setImageId, i,  count)
	local buttonFrame = buildTextButton(&quot;&quot;)
	buttonFrame.Name = &quot;SetButton&quot;
	buttonFrame.Size = UDim2.new(1.0, 0, 0.0, height*2)
	buttonFrame.Position = UDim2.new(0.0, 0, 0.0, (i-1)*height*2)
	buttonFrame.Button.BackgroundColor3 = buttonColor
	buttonFrame.Button.TextColor3 = buttonTextColor
	buttonFrame.Visible = false

	local setNameLabel = Instance.new(&quot;TextLabel&quot;)
	setNameLabel.Name = &quot;Name&quot;
	setNameLabel.Text = name
	setNameLabel.TextColor3 = buttonTextColor
	setNameLabel.BackgroundTransparency = 1.0
	setNameLabel.Size = UDim2.new(1.0, -height*2, 1.0, 0.0)
	setNameLabel.Position = UDim2.new(0.0, height*2, 0.0, 0)
	setNameLabel.TextWrap = true
	setNameLabel.TextXAlignment = Enum.TextXAlignment.Left
	setNameLabel.Parent = buttonFrame.Button
	
	local iconLabel = Instance.new(&quot;ImageLabel&quot;)
	iconLabel.Name = &quot;Icon&quot;
	iconLabel.Image = BaseUrl .. &quot;asset/?id=&quot; .. setImageId
	iconLabel.Size = UDim2.new(0.0, height*2 - 4, 0.0, height*2 -4)
	iconLabel.Position = UDim2.new(0.0, 2, 0.0, 2)
	iconLabel.Transparency = insertButtonTransparency
	iconLabel.Parent = buttonFrame.Button
	
	local setValue = Instance.new(&quot;IntValue&quot;)
	setValue.Name = &quot;SetId&quot;
	setValue.Value = setId
	setValue.Parent = buttonFrame

	local setName = Instance.new(&quot;StringValue&quot;)
	setName.Name = &quot;SetName&quot;
	setName.Value = name
	setName.Parent = buttonFrame
	
	buttonFrame.Button.MouseButton1Click:connect(function() selectSet(buttonFrame, buttonFrame.SetName.Value, buttonFrame.SetId.Value, 0) end)
	buttonFrame.Button.MouseEnter:connect(function() mouseEnterSetButton(buttonFrame) end)
	buttonFrame.Button.MouseLeave:connect(function() mouseLeaveSetButton(buttonFrame) end)

	--print(&quot;Built button &quot; .. i .. &quot; SetId=&quot; .. setId .. &quot; SetName=&quot; .. name)

	return buttonFrame
end

function previousSetPage() 
	local newIndex = math.max(1, Data.Category[Data.CurrentCategory].Index - (Data.Main.InsertRows * Data.Main.InsertColumns))
	setSetIndex(newIndex) 
end

function nextSetPage()
	local newIndex = math.max(0, Data.Category[Data.CurrentCategory].Index + (Data.Main.InsertRows * Data.Main.InsertColumns))
	setSetIndex(newIndex)
end

function setSetIndex(dataOffset)
	Data.Category[Data.CurrentCategory].Index = dataOffset

	local PageSize = Data.Main.InsertRows*Data.Main.InsertColumns 
	local contents = Data.Category[Data.CurrentCategory].Contents
	if contents then
		for index = 1, PageSize do
			if Data.InsertButtons[index] then
				if contents[index + dataOffset] then
					--for key, value in pairs(contents[index+dataOffset]) do
					--	print(&quot;key=&quot; .. key .. &quot;, value=&quot; .. value)
					--end

					local assetId
					if useAssetVersionId then
						assetId = contents[index + dataOffset].AssetVersionId 
					else 
						assetId = contents[index + dataOffset].AssetId
					end
					setInsertButtonImageBehavior(Data.InsertButtons[index], true, contents[index + dataOffset].Name, assetId)
				else
					setInsertButtonImageBehavior(Data.InsertButtons[index], false)
				end
			end
		end
		Window.Main.PreviousPageButton.Visible = dataOffset &gt; 0
		Window.Main.NextPageButton.Visible = (dataOffset + PageSize) &lt; (#contents)
	else
		Window.Main.PreviousPageButton.Visible = false
		Window.Main.NextPageButton.Visible = false
	end
end

function previousCategoryPage() 
	local newIndex = math.max(0, Data.Category[Data.CurrentCategory].SetIndex - Data.Main.InsertSets)
	setCategoryIndex(newIndex) 
end

function nextCategoryPage()
	local newIndex = math.max(0, Data.Category[Data.CurrentCategory].SetIndex + Data.Main.InsertSets)
	setCategoryIndex(newIndex)
end

function setCategoryIndex(setIndex)
	Data.Category[Data.CurrentCategory].SetIndex = setIndex
	--This is how many vertical items we can display

	--Layout all buttons in this setoh
	if #Data.CurrentCategory &gt; Data.Main.InsertSets then
		--Steal one for use by the layout buttons, when it rains it pours

		--We can&apos;t fit all the buttons
		local heightUsed = 0

		local index = 1
		if index &lt; setIndex then
			heightUsed = height
			Window.Main.PreviousSetButton.Visible = true
			while index &lt; setIndex do
				Data.CurrentCategory[index].Visible = false
				index = index + 1
			end
		else
			Window.Main.PreviousSetButton.Visible = false
		end

		local offset = 0
		while offset &lt; Data.Main.InsertSets and index + offset &lt;= #Data.CurrentCategory do
			Data.CurrentCategory[index + offset].Size = UDim2.new(1.0, 0, 0.0, height*2)
			Data.CurrentCategory[index + offset].Position = UDim2.new(0.0, 0, 0.0, height*2*offset + heightUsed)
			Data.CurrentCategory[index + offset].Visible = true
			offset = offset + 1
		end
		index = index + offset
		heightUsed = heightUsed + Data.Main.InsertSets*height*2

		if index &lt;= #Data.CurrentCategory then
			Window.Main.NextSetButton.Position = UDim2.new(0.0, 0, 0.0, heightUsed)
			Window.Main.NextSetButton.Size = UDim2.new(1.0, 0, 1.0, -heightUsed)
			Window.Main.NextSetButton.Visible = true
			while index &lt;=  #Data.CurrentCategory do
				Data.CurrentCategory[index].Visible = false
				index = index + 1
			end		
		else
			Window.Main.NextSetButton.Visible = false
		end
		--Window.Main.Frame.SetTab.SetFiller.Size = UDim2.new(0.0, 0, 0.0, 0)
	else
		Window.Main.PreviousSetButton.Visible = false
		Window.Main.NextSetButton.Visible = false

		for key, buttonFrame in pairs(Data.CurrentCategory) do
			buttonFrame.Size = UDim2.new(1.0, 0, 0.0, height*2)
			buttonFrame.Position = UDim2.new(0.0, 0, 0.0, height*2*(key-1))
			buttonFrame.Visible = true
		end

		--Then expand this to fill the remaining space at the bottom
		--Window.Main.Frame.SetTab.SetFiller.Position = UDim2.new(0.0, 0, 0.0, height*2*#Data.CurrentCategory)
		--Window.Main.Frame.SetTab.SetFiller.Size = UDim2.new(1.0, 0, 0.0, frameHeight - height*2*#Data.CurrentCategory)
	end
end

function selectCategoryPage(buttons, page)
	if buttons ~= Data.CurrentCategory then		
		if Data.CurrentCategory then
			for key, button in pairs(Data.CurrentCategory) do
				button.Visible = false
			end
		end

		Data.CurrentCategory = buttons		
		if Data.Category[Data.CurrentCategory] == nil then
			Data.Category[Data.CurrentCategory] = {}
			if #buttons &gt; 0 then
				selectSet(buttons[1], buttons[1].SetName.Value, buttons[1].SetId.Value, 0)
			end
		else
			Data.Category[Data.CurrentCategory].Button = nil
			selectSet(Data.Category[Data.CurrentCategory].ButtonFrame, Data.Category[Data.CurrentCategory].SetName, Data.Category[Data.CurrentCategory].SetId, Data.Category[Data.CurrentCategory].Index)
		end
		if Data.Main.FrameHeight then
			if Data.Category[Data.CurrentCategory].SetIndex then
				layoutSetButtons(Data.Main.FrameHeight, Data.Category[Data.CurrentCategory].SetIndex)
			else
				layoutSetButtons(Data.Main.FrameHeight, 1)
			end
		end


	end
end
function filterSet(set)
	if soloGame then
		return set
	end

	local result = {}
	for pos, object in pairs(set) do
		if object.IsTrusted then
			result[#result+1] = object
		end
	end
	return result
end
function selectSet(buttonFrame, setName, setId, setIndex)
	if buttonFrame then
		if buttonFrame.Button ~= Data.Category[Data.CurrentCategory].Button then
			if Data.Category[Data.CurrentCategory].Button ~= nil then
				Data.Category[Data.CurrentCategory].Button.BackgroundColor3 = buttonColor
				Data.Category[Data.CurrentCategory].Button.TextColor3 = buttonTextColor
				Data.Category[Data.CurrentCategory].Button.Icon.Transparency = insertButtonTransparency
				Data.Category[Data.CurrentCategory].Button.AutoButtonColor = true
			end
			
			Data.Category[Data.CurrentCategory].Button = buttonFrame.Button
			Data.Category[Data.CurrentCategory].Button.BackgroundColor3 = selectedButtonColor
			Data.Category[Data.CurrentCategory].Button.TextColor3 = selectedButtonTextColor
			Data.Category[Data.CurrentCategory].Button.Icon.Transparency = 0.0
			Data.Category[Data.CurrentCategory].Button.AutoButtonColor = false
		
			if SetCache[setId] == nil then
				SetCache[setId] = filterSet(game:GetService(&quot;InsertService&quot;):GetCollection(setId))
			end
			Data.Category[Data.CurrentCategory].Contents = SetCache[setId]
			Window.Main.Title.Text = setName

			Data.Category[Data.CurrentCategory].SetName = setName
			Data.Category[Data.CurrentCategory].SetId = setId
			Data.Category[Data.CurrentCategory].ButtonFrame = buttonFrame
		end

		setSetIndex (setIndex)
	end
end

function selectCategory(button, category)
	if Data.CurrentCategory ~= category then
		if Data.CurrentCategoryButton then
			Data.CurrentCategoryButton.BackgroundColor3 = buttonColor
			Data.CurrentCategoryButton.TextColor3 = buttonTextColor
			Data.CurrentCategoryButton.AutoButtonColor = true
		end
	end
	selectCategoryPage(category, 0)

	Data.CurrentCategoryButton = button
	Data.CurrentCategoryButton.BackgroundColor3 = selectedButtonColor
	Data.CurrentCategoryButton.TextColor3 = selectedButtonTextColor
	Data.CurrentCategoryButton.AutoButtonColor = false
end

function processCategory(sets, setPanel)
	local setButtons = {}
	for index, object in pairs(sets) do
		--for key, value in pairs(object) do
		--	print(&quot;key=&quot; .. key .. &quot;, value=&quot; .. value)
		--end
		setButtons[index] = buildSetButton(object.Name, object.CategoryId, object.ImageAssetId, index, #sets)
		setButtons[index].Parent = setPanel	
	end
	return setButtons
end

function buildMainGui(root, userId)
	Window.Main = {}
	Data.Main = {}
	Data.Category = {}
	
	local mainFrame = Instance.new(&quot;Frame&quot;)
	mainFrame.Name = &quot;InsertMainDialog&quot;
	mainFrame.Position = UDim2.new(0.0, 0, 0.25, 0)
	mainFrame.Size = UDim2.new(0.75, 0, 0.75, 0)
	mainFrame.Transparency = 1.0
	mainFrame.Active = true
	mainFrame.Parent = root
	Window.Main.Frame = mainFrame

	local setTab = Instance.new(&quot;Frame&quot;)
	setTab.Position = UDim2.new(0.0, 0, 0.0, 0)
	setTab.Size = UDim2.new(0.15, 0, 1.0, 0)
	setTab.BackgroundTransparency = 1.0
	setTab.Name = &quot;SetTab&quot;
	setTab.Parent = mainFrame

	local setPanel = Instance.new(&quot;Frame&quot;)
	setPanel.Position = UDim2.new(0.0, 0, 0.0, 0)
	setPanel.Size = UDim2.new(1.0, 0, 1.0, 0)
	setPanel.BackgroundTransparency = 1.0
	setPanel.Name = &quot;SetPanel&quot;
	setPanel.Parent = setTab

	local setFiller = Instance.new(&quot;Frame&quot;)
	setFiller.Name = &quot;SetFiller&quot;
	setFiller.Size = UDim2.new(0.0, 0, 0.0, 0)
	setFiller.Position = UDim2.new(0.0, 0, 0.0, 0)
	setFiller.BackgroundColor3 = frameColor
	setFiller.BackgroundTransparency = transparency*.5
	setFiller.Parent = setTab
	
	local previousSetButton = Instance.new(&quot;TextButton&quot;)
	previousSetButton.Name = &quot;PreviousSetButton&quot;
	previousSetButton.Size = UDim2.new(1.0, 0, 0, height)
	previousSetButton.Position = UDim2.new(0.0, 0, 0.0, 0)
	previousSetButton.BackgroundColor3 = buttonColor
	previousSetButton.TextColor3 = buttonTextColor
	previousSetButton.BackgroundTransparency = transparency
	previousSetButton.Text = &quot;...&quot;
	previousSetButton.MouseButton1Click:connect(previousCategoryPage)
	previousSetButton.Parent = setTab
	previousSetButton.Visible = false
	Window.Main.PreviousSetButton = previousSetButton

	local nextSetButton = Instance.new(&quot;TextButton&quot;)
	nextSetButton.Name = &quot;NextSetButton&quot;
	nextSetButton.Size = UDim2.new(1.0, 0, 0.0, height)
	nextSetButton.Position = UDim2.new(0.0, 0, 1.0, -height)
	nextSetButton.BackgroundColor3 = buttonColor
	nextSetButton.TextColor3 = buttonTextColor
	nextSetButton.BackgroundTransparency = transparency
	nextSetButton.Text = &quot;...&quot;
	nextSetButton.MouseButton1Click:connect(nextCategoryPage)
	nextSetButton.Parent = setTab
	nextSetButton.Visible = false
	Window.Main.NextSetButton = nextSetButton

	local insertTab = Instance.new(&quot;Frame&quot;)
	insertTab.Name = &quot;InsertTab&quot;
	insertTab.Position = UDim2.new(0.15, 0, 0.0, 0)
	insertTab.Size = UDim2.new(0.85, 0, 1.0, 0)
	insertTab.BackgroundTransparency = 1.0
	insertTab.Parent = mainFrame
	
	Data.BaseCategoryButtons = processCategory(game:GetService(&quot;InsertService&quot;):GetBaseCategories(), setPanel)	
	local userData = game:GetService(&quot;InsertService&quot;):GetUserCategories(userId)
	if userData then
		Data.UserCategoryButtons = processCategory(userData, setPanel)

		local userCategoryButton = Instance.new(&quot;TextButton&quot;)
		userCategoryButton.Name = &quot;UserCategoryButton&quot;
		userCategoryButton.Size = UDim2.new(0.25, 0, 0, height)
		userCategoryButton.Position = UDim2.new(0.25, 0, 0.0, -height)
		userCategoryButton.BackgroundColor3 = buttonColor
		userCategoryButton.TextColor3 = buttonTextColor
		userCategoryButton.BackgroundTransparency = transparency*.5
		userCategoryButton.Text = &quot;User Sets&quot;
		userCategoryButton.MouseButton1Click:connect(function() selectCategory(userCategoryButton, Data.UserCategoryButtons) end)
		userCategoryButton.Parent = insertTab
	end
	--Data.UserCategoryButtons =  processCategory(game:GetService(&quot;InsertService&quot;):GetBaseCategories(), setPanel)

	local baseCategoryButton = Instance.new(&quot;TextButton&quot;)
	baseCategoryButton.Name = &quot;RobloxCategoryButton&quot;
	baseCategoryButton.Size = UDim2.new(0.25, 0, 0, height)
	baseCategoryButton.Position = UDim2.new(0.0, 0, 0.0, -height)
	baseCategoryButton.BackgroundColor3 = buttonColor
	baseCategoryButton.TextColor3 = buttonTextColor
	baseCategoryButton.BackgroundTransparency = transparency *.5
	baseCategoryButton.Text = &quot;Roblox Sets&quot;
	baseCategoryButton.MouseButton1Click:connect(function() selectCategory(baseCategoryButton, Data.BaseCategoryButtons) end)
	baseCategoryButton.Parent = insertTab

	local titleFrame = Instance.new(&quot;TextLabel&quot;)
	titleFrame.Name = &quot;Title&quot;
	titleFrame.Position = UDim2.new(0.0, 0, 0.0, 0)
	titleFrame.Size = UDim2.new(1.0, 0, 0.0, height)
	titleFrame.TextWrap = true
	titleFrame.BackgroundColor3 = titleColor
	titleFrame.TextColor3 = titleTextColor
	titleFrame.BackgroundTransparency = .1
	titleFrame.Text = &quot;Set Foo&quot;
	titleFrame.Parent = insertTab
	Window.Main.Title = titleFrame

	local minimizeButton = Instance.new(&quot;ImageButton&quot;)
	minimizeButton.Name = &quot;Minimize&quot;
	minimizeButton.Position = UDim2.new(1.0, -height + 1, 0.0, 1)
	minimizeButton.Size = UDim2.new(0.0, height-2, 0.0, height-2)
	minimizeButton.Image = BaseUrl .. &quot;asset?id=20889725&quot;
	minimizeButton.MouseButton1Click:connect(minimize)
	minimizeButton.Parent = titleFrame

	local insertPanel = Instance.new(&quot;Frame&quot;)
	insertPanel.Name = &quot;InsertPanel&quot;
	insertPanel.Position = UDim2.new(0.0, 0, 0.0, height)
	insertPanel.Size = UDim2.new(1.0, 0, 1.0, -2*height)
	insertPanel.BackgroundColor3 = frameColor
	insertPanel.BackgroundTransparency = transparency
	insertPanel.Parent = insertTab

	local footerPanel = Instance.new(&quot;Frame&quot;)
	footerPanel.Name = &quot;Footer&quot;
	footerPanel.Size = UDim2.new(1.0, 0, 0, height)
	footerPanel.Position = UDim2.new(0.0, 0, 1.0, -height)
	footerPanel.BackgroundTransparency = transparency
	footerPanel.BackgroundColor3 = frameColor
	footerPanel.Parent = insertTab
	
	local rolloverText = Instance.new(&quot;TextLabel&quot;)
	rolloverText.Name = &quot;RolloverText&quot;
	rolloverText.Size = UDim2.new(0.8, 0, 1.0, 0)
	rolloverText.Position = UDim2.new(0.1, 0, 0.0, 0)
	rolloverText.TextColor3 = frameTextColor
	rolloverText.BackgroundColor3 = frameColor
	rolloverText.BackgroundTransparency = transparency
	rolloverText.Text = &quot;&quot;
	rolloverText.TextWrap = true
	rolloverText.Parent = footerPanel
	Window.Main.RolloverText = rolloverText

	local previousButton = Instance.new(&quot;TextButton&quot;)
	previousButton.Name = &quot;PreviousPageButton&quot;
	previousButton.Size = UDim2.new(0.1, 0, 1.0, 0)
	previousButton.Position = UDim2.new(0.0, 0, 0.0, 0)
	previousButton.BackgroundColor3 = buttonColor
	previousButton.TextColor3 = buttonTextColor
	previousButton.BackgroundTransparency = transparency
	previousButton.Text = &quot;&lt;--&quot;
	previousButton.MouseButton1Click:connect(previousSetPage)
	previousButton.Parent = footerPanel
	previousButton.Visible = false
	Window.Main.PreviousPageButton = previousButton

	local nextButton = Instance.new(&quot;TextButton&quot;)
	nextButton.Name = &quot;NextPageButton&quot;
	nextButton.Size = UDim2.new(0.1, 0, 1.0, 0)
	nextButton.Position = UDim2.new(0.9, 0, 0.0, 0)
	nextButton.BackgroundColor3 = buttonColor
	nextButton.TextColor3 = buttonTextColor
	nextButton.BackgroundTransparency = transparency
	nextButton.Text = &quot;--&gt;&quot;
	nextButton.MouseButton1Click:connect(nextSetPage)
	nextButton.Parent = footerPanel
	nextButton.Visible = false
	Window.Main.NextPageButton = nextButton

	local insertButtons = {}
	for y = 1, InsertRows do
		for x = 1, InsertColumns do
			insertButtons[x  + (y - 1) * InsertColumns] = buildInsertButton(UDim2.new(.125*(x-1), 2, 0.25*(y-1), 2), UDim2.new(.125, -4, .25, -4))
			insertButtons[x  + (y - 1) * InsertColumns].Parent = insertPanel
		end
	end	
	Data.InsertButtons = insertButtons
	Data.Main.InsertRows = InsertRows
	Data.Main.InsertColumns = InsertColumns
	
	selectCategory(baseCategoryButton, Data.BaseCategoryButtons)
end

function layoutInsertButtons(guiMain)
	local size = guiMain.AbsoluteSize
	
	local frameSize = 0.75 * size
	local frameSizeUsed = Vector2.new(0, height*2)

	--We want 15% or 100 pixels, which ever is smaller
	if frameSize.x * .15 &lt; 100 then
		local oldSize = Window.Main.Frame.SetTab.Size
		Window.Main.Frame.SetTab.Size = UDim2.new(0.0, 100, oldSize.Y.Scale, oldSize.Y.Offset)
		Window.Main.Frame.InsertTab.Position = UDim2.new(0.0, 100, 0.0, 0)
		frameSizeUsed = Vector2.new(frameSizeUsed.x + 100, frameSizeUsed.y)
	else
		local oldSize = Window.Main.Frame.SetTab.Size
		Window.Main.Frame.SetTab.Size = UDim2.new(0.15, 0, oldSize.Y.Scale, oldSize.Y.Offset)
		Window.Main.Frame.InsertTab.Position = UDim2.new(0.15, 0, 0.0, 0)
		frameSizeUsed = Vector2.new(frameSizeUsed.x + .15*frameSize.x, frameSizeUsed.y)
	end

	--Decide how many buttons we can fit, and what size to make the insert buttons
	--2 sizes of insert buttons, 50x50 and 100x100

	local buttonSize = 110
	while buttonSize &gt; 70 and math.floor((frameSize - frameSizeUsed).x/buttonSize) * math.floor((frameSize - frameSizeUsed).y/buttonSize) &lt; 32 do
		buttonSize = buttonSize - 10
	end
	
	Data.Main.InsertColumns = math.min(math.max(1, math.floor((frameSize - frameSizeUsed).x/buttonSize)), InsertColumns)
	Data.Main.InsertRows = math.min(math.max(1, math.floor((frameSize - frameSizeUsed).y/buttonSize)), InsertRows)
	
	for index, button in pairs(Data.InsertButtons) do
		if index &lt;= Data.Main.InsertRows * Data.Main.InsertColumns then
			button.Visible = true
			button.Size = UDim2.new(0, buttonSize-4, 0, buttonSize-4)
			button.Position = UDim2.new(0, buttonSize * ((index-1)%Data.Main.InsertColumns) + 2 + 2,
								       0, buttonSize * math.floor((index-1)/Data.Main.InsertColumns) + 2 + 2)
		else
			button.Visible = false
		end
	end
	Window.Main.Frame.InsertTab.Size = UDim2.new(0.0, buttonSize * Data.Main.InsertColumns + 4, 0.0, buttonSize * Data.Main.InsertRows + height*2 + 4)

	if Data.Category[Data.CurrentCategory].Index == nil then
		setSetIndex(0)
	else
		setSetIndex(Data.Category[Data.CurrentCategory].Index)
	end
	
	local finalFrameHeight = frameSizeUsed.y + Data.Main.InsertRows*buttonSize + 4
	Window.Main.Frame.Size = UDim2.new(0, frameSizeUsed.x + Data.Main.InsertColumns*buttonSize + 4, 0, finalFrameHeight)
	Window.Main.Frame.Position = UDim2.new(0.0, 0, 1.0, -Window.Main.Frame.Size.Y.Offset)

	if Data.Category[Data.CurrentCategory].SetIndex == nil then
		layoutSetButtons(finalFrameHeight, 1)
	else
		layoutSetButtons(finalFrameHeight, Data.Category[Data.CurrentCategory].SetIndex)
	end
end

function layoutSetButtons(frameHeight, setIndex)
	Data.Main.FrameHeight = frameHeight
	Data.Main.InsertSets = math.floor(frameHeight / (height*2))
	if #Data.CurrentCategory &gt; Data.Main.InsertSets then
		--Steal one entry since we have two many things
		Data.Main.InsertSets = Data.Main.InsertSets - 1 
	end

	print(&quot;Layout Set Buttons index=&quot; .. setIndex .. &quot;, InsertSets=&quot;..Data.Main.InsertSets)
	
	setCategoryIndex(setIndex)
end


function insertComplete()
	Window.Loading.Frame.Visible = false
	Window.Stamp.Frame.Visible = false
	Window.Main.Frame.Visible = true
end

function UnlockInstances(object)
	if object:IsA(&quot;BasePart&quot;) then
		object.Locked = false
	end
	for index,child in pairs(object:GetChildren()) do
		UnlockInstances(child)
	end
end

function beginInsertDecal(decal)

	Data.Stamp.DecalSelection = Instance.new(&quot;SurfaceSelection&quot;)
	Data.Stamp.DecalSelection.Color = BrickColor.new(&quot;Bright orange&quot;)
	Data.Stamp.DecalSelection.archivable = false
	Data.Stamp.DecalSelection.Parent = getPlayer().PlayerGui
	
	--Save the decal in our Lua code for later use
	Data.Stamp.Decal = decal
	Data.Stamp.Decal.Parent = nil
end

function beginInsertAsset(assetName, assetId, image, stampMode)
	--Copy over details into dialog window
	Window.Loading.AssetThumbLabel.Image = image
	Window.Loading.AssetNameLabel.Text = assetName
	
	Window.Stamp.AssetThumbLabel.Image = image
	Window.Stamp.AssetNameLabel.Text = assetName
	Data.Stamp.StampMode = stampMode

	--Hide the main window
	Window.Main.Frame.Visible = false
	--Show the dialog window
	Window.Loading.Frame.Visible = true
	Data.Loading.Cancelled = false

	--This call will cause a &quot;wait&quot; until the data comes back
	local root
	if useAssetVersionId then
		root = game:GetService(&quot;InsertService&quot;):LoadAssetVersion(assetId)
	else
		root = game:GetService(&quot;InsertService&quot;):LoadAsset(assetId)
	end

	if Data.Loading.Cancelled then
		--The user got bored and wandered off

		--Just delete the model from the world... a shame we loaded it when they got bored
		root:Remove()
	else
		Window.Loading.Frame.Visible = false
		
		local instances = root:GetChildren()
		if #instances == 0 then
			root:Remove()
			insertComplete()
			return
		end

		--Unlock all parts that are inserted, to make sure they are editable
		UnlockInstances(root)

		--Continue the insert process
		root.Name = &quot;InsertedObject&quot; .. assetId

		--Examine the contents and decide what it looks like
		for pos, instance in pairs(instances) do
			--Single instance objects might be treated special, decals/skyboxes
			if instance:IsA(&quot;Decal&quot;) then
				--Current system here stops after finding one Decal (and gives you Decal tool)
				--We should do the same (probably)
				beginInsertDecal(instance)
				root:Remove()
				
				Window.Stamp.Frame.Visible = true
				return
			elseif instance:IsA(&quot;Team&quot;) then
				instance.Parent = game:GetService(&quot;Teams&quot;)
			elseif instance:IsA(&quot;SpawnLocation&quot;) then
				
			elseif instance:IsA(&quot;HopperBin&quot;) then
				-- Must go into the starterPack, prompt user?
			elseif instance:IsA(&quot;Tool&quot;) then
				-- Ask them if it should go in StarterPack? 
			elseif instance:IsA(&quot;Sky&quot;) then
				local lightingService = game:GetService(&quot;Lighting&quot;)
				for index,child in pairs(lightingService:GetChildren()) do
					if child:IsA(&quot;Sky&quot;) then
						child:Remove();
					end
				end
				instance.Parent = lightingService
				return
			else
				
			end
		end

		if #root:GetChildren() == 0 then
			root:Remove()
			insertComplete()
			return
		end

		Window.Stamp.Frame.Visible = true
		Data.Stamp.Model = root
	end
end

function cancelAssetLoad()
	Data.Loading.Cancelled = true
	insertComplete()
end

function buildLoadingDialogGui(root)
	Window.Loading = {}
	Data.Loading = {}

	local dialogFrame = Instance.new(&quot;Frame&quot;)
	dialogFrame.Name = &quot;InsertLoadingDialog&quot;
	dialogFrame.Size = UDim2.new(0.0, height*10, 0, height*5)
	dialogFrame.Position = UDim2.new(0.5, -height*5, 0.5, -height*2.5)
	dialogFrame.BackgroundColor3 = frameColor
	dialogFrame.Active = true
	dialogFrame.Parent = root
	dialogFrame.Visible = false
	Window.Loading.Frame = dialogFrame

	local assetThumb = Instance.new(&quot;ImageLabel&quot;)
	assetThumb.Position = UDim2.new(0.0, 2, 0.0, 2)
	assetThumb.Size = UDim2.new(0.5, -4, 1.0, -4)
	assetThumb.Parent = dialogFrame
	Window.Loading.AssetThumbLabel = assetThumb

	local descriptionFrame = Instance.new(&quot;Frame&quot;)
	descriptionFrame.Name = &quot;Description&quot;
	descriptionFrame.Size = UDim2.new(0.5, 0, 1.0, 0)
	descriptionFrame.Position = UDim2.new(0.5, 0, 0.0, 0)
	descriptionFrame.Transparency = 1
	descriptionFrame.Parent = dialogFrame

	local label = Instance.new(&quot;TextLabel&quot;)
	label.Text = &quot;Loading...&quot;
	label.Position = UDim2.new(0.5, 0, 0, 0);
	label.Size = UDim2.new(0.0, 0, 0.0, height)
	label.BorderSizePixel = 0
	label.TextColor3 = frameTextColor
	label.Parent = descriptionFrame
	
	local assetLabel = Instance.new(&quot;TextLabel&quot;)
	assetLabel.Text = &quot;Your Asset Here&quot;
	assetLabel.Position = UDim2.new(0.0, 0, 0.0, height)
	assetLabel.Size = UDim2.new(1.0, 0, 1.0, -2*height)
	assetLabel.BorderSizePixel = 0
	assetLabel.BackgroundTransparency = 1.0
	assetLabel.Parent = descriptionFrame
	assetLabel.TextColor3 = frameTextColor
	assetLabel.TextWrap = true
	Window.Loading.AssetNameLabel = assetLabel	

	local cancelButton = Instance.new(&quot;TextButton&quot;)
	cancelButton.Name = &quot;PreviousPageButton&quot;
	cancelButton.Size = UDim2.new(0, height*3, 0, height)
	cancelButton.Position = UDim2.new(0.5, -height*1.5, 1.0, -height*1.2)
	cancelButton.BackgroundColor3 = buttonColor
	cancelButton.TextColor3 = buttonTextColor
	cancelButton.Text = &quot;Cancel&quot;
	cancelButton.MouseButton1Click:connect(cancelAssetLoad)
	cancelButton.Parent = descriptionFrame
end



function cancelAssetPlacement()
	Data.Stamp.Cancelled = true
	Data.Stamp.Dragger = nil
	if Data.Stamp.Model then
		Data.Stamp.Model:Remove()
		Data.Stamp.Model = nil
	end
	if Data.Stamp.CurrentParts then
		for index, object in pairs(Data.Stamp.CurrentParts) do
			object:Remove()
		end
		Data.Stamp.CurrentParts = nil
	end

	if Data.Stamp.DecalSelection then
		Data.Stamp.DecalSelection:Remove()
		Data.Stamp.DecalSelection = nil
	end
	if Data.Stamp.Decal then
		Data.Stamp.Decal:Remove()
		Data.Stamp.Decal = nil
	end

	if Mouse then
		Mouse.Icon =&quot;rbxasset://textures\\ArrowCursor.png&quot;
	end	
	insertComplete()
end

function onInsertKeyDown(key)
	if Data.Stamp.Dragger then
		if key == &apos;R&apos; or key == &apos;r&apos;  then
			Data.Stamp.Dragger:AxisRotate(Enum.Axis.Y)
		elseif key == &apos;T&apos; or key == &apos;t&apos; then
			Data.Stamp.Dragger:AxisRotate(Enum.Axis.Z)
		end
	end
	if key == &apos;&#27;&apos; then
		minimize()
	end
end


function canSelectObject(part)
	return part and not (part.Locked) and part:IsA(&quot;BasePart&quot;) and (part.Position - Tool.Parent.Head.Position).Magnitude &lt; 60
end

function setSelectionSurface(part, surface) 
	if Data.Stamp.DecalSelection.Adornee == part and Data.Stamp.DecalSelection.TargetSurface == surface then
		return
	end
	unsetSelectionSurface()
	Data.Stamp.DecalSelection.Adornee = part
	Data.Stamp.DecalSelection.TargetSurface = surface
	--selectionLasso.Part = part

	local decalFound = false
	for index,child in pairs(part:GetChildren()) do
		if child:IsA(&quot;Decal&quot;) and child.Face == surface then
			decalFound = true
			break
		end
	end

	if not(decalFound) then
		Data.Stamp.Decal.Parent = part
		Data.Stamp.Decal.Face = surface
	end
end

function unsetSelectionSurface() 
	Data.Stamp.DecalSelection.Adornee = nil
	--selectionLasso.Part = nil
	Data.Stamp.Decal.Parent = nil
end

function onInsertMouseMove() 
	if Data.Stamp.MovingLock then
		return
	end

	local newCursor = &quot;rbxasset://textures\\ArrowCursor.png&quot;
	Data.Stamp.MovingLock = true
	if Data.Stamp.Decal then
		local part = Mouse.Target
		if canSelectObject(part) then
			setSelectionSurface(part, Mouse.TargetSurface)
		else
			unsetSelectionSurface()
			newCursor = BaseUrl .. &quot;asset?id=20715642&quot;
		end
	elseif Data.Stamp.Dragger == nil then
		if Data.Stamp.Model ~= nil then
			Mouse.Icon =&quot;rbxasset://textures//GrabRotateCursor.png&quot;
			setupDraggableClone()
		end
	else
		Data.Stamp.Dragger:MouseMove(Mouse.UnitRay)
	end
	Mouse.Icon = newCursor

	Data.Stamp.MovingLock = false
end

function onInsertMouseButton1Down()
	if Data.Stamp.Dragger or Data.Stamp.Decal then
		Data.Stamp.MouseDown = true
	end
end

function onInsertMouseButton1Up()
	if Data.Stamp.MouseDown then
		Data.Stamp.MouseDown = false
		if Data.Stamp.Decal then
			local part = Mouse.Target
			if canSelectObject(part) and Instance.Lock(part) then
				local surface = Mouse.TargetSurface 
				for index,child in pairs(part:GetChildren()) do
					if child:IsA(&quot;Decal&quot;) and child.Face == surface then
						child:Remove()
					end
				end

				local newDecal  = Data.Stamp.Decal:Clone()
				newDecal.Face = surface
				newDecal.Parent = part
					Instance.Unlock(part)
				
				if Data.Stamp.StampMode then
				else 
					Instance.Unlock(part)
					cancelAssetPlacement()
				end
			end
		elseif Data.Stamp.Dragger then
			--Place the object where the mouse is currently positioned
			Data.Stamp.Dragger:MouseUp()
		
			--Fix the transparency of all the parts
			for part, transparency in pairs(Data.Stamp.TransparencyTable) do
				part.Transparency = transparency
			end
			Data.Stamp.TransparencyTable = nil

			--Re-enable the scripts
			for index,script in pairs(Data.Stamp.DisabledScripts) do
				script.Disabled = false
			end
			--Now that they are all marked enabled, reinsert them into the world so they start running
			for index,script in pairs(Data.Stamp.DisabledScripts) do
				local oldParent = script.Parent
				script.Parent = nil
				script:Clone().Parent = oldParent
			end
			Data.Stamp.DisabledScripts = nil

			Data.Stamp.Dragger = nil
			Data.Stamp.CurrentParts = nil
			
			if Data.Stamp.StampMode then
				--Now set up a new instance of the object to allow a second copy to be stamped down
				setupDraggableClone()
			else
				cancelAssetPlacement()
			end
		end
	end
end


function collectParts(object, baseParts, scripts)
	if object:IsA(&quot;BasePart&quot;) then
		baseParts[#baseParts+1] = object
	elseif object:IsA(&quot;Script&quot;) then
		scripts[#scripts+1] = object
	end

	for index,child in pairs(object:GetChildren()) do
		collectParts(child, baseParts, scripts)
	end
end



function setupDraggableClone()
	local clone = Data.Stamp.Model:Clone()
	local scripts = {}
	local parts = {}

	collectParts(clone, parts, scripts)

	if #parts &gt; 0 then
		Data.Stamp.DisabledScripts = {}
		Data.Stamp.TransparencyTable = {}

		for index,script in pairs(scripts) do
			if not(script.Disabled) then
				script.Disabled = true
				Data.Stamp.DisabledScripts[#Data.Stamp.DisabledScripts +1] = script
			end
		end
		for index, part in pairs(parts) do
			Data.Stamp.TransparencyTable[part] = part.Transparency
			part.Transparency = 0.5
		end

		game:GetService(&quot;InsertService&quot;):Insert(clone)
		
		Data.Stamp.CurrentParts = clone:GetChildren();
		for index, object in pairs(Data.Stamp.CurrentParts) do
			object.Parent = clone.Parent
		end
		clone:Remove();
		
		Data.Stamp.Dragger = Instance.new(&quot;Dragger&quot;)
		--Begin a movement by faking a MouseDown signal
		Data.Stamp.Dragger:MouseDown(parts[1], Vector3.new(0,0,0), parts)
		Data.Stamp.Dragger:MouseMove(Mouse.UnitRay)
	else
		--Nothing draggable in the Model
		Data.Stamp.Model:Remove()
		Data.Stamp.Model = nil
		Data.Stamp.TransparencyTable = nil
		Data.Stamp.DisabledScripts = nil
	end
end
function buildStampDialogGui(root)
	Window.Stamp = {}
	Data.Stamp = {}

	local dialogFrame = Instance.new(&quot;Frame&quot;)
	dialogFrame.Name = &quot;InsertStampDialog&quot;
	dialogFrame.Size = UDim2.new(0.0, height*10, 0, height*5)
	dialogFrame.Position = UDim2.new(0.0, 0, 1.0, -height*5)
	dialogFrame.BackgroundColor3 = frameColor
	dialogFrame.Active = true
	dialogFrame.Parent = root
	dialogFrame.Visible = false
	Window.Stamp.Frame = dialogFrame

	local assetThumb = Instance.new(&quot;ImageLabel&quot;)
	assetThumb.Position = UDim2.new(0.0, 2, 0.0, 2)
	assetThumb.Size = UDim2.new(0.5, -4, 1.0, -4)
	assetThumb.Parent = dialogFrame
	Window.Stamp.AssetThumbLabel = assetThumb

	local descriptionFrame = Instance.new(&quot;Frame&quot;)
	descriptionFrame.Name = &quot;Description&quot;
	descriptionFrame.Size = UDim2.new(0.5, 0, 1.0, 0)
	descriptionFrame.Position = UDim2.new(0.5, 0, 0.0, 0)
	descriptionFrame.Transparency = 1
	descriptionFrame.Parent = dialogFrame

	local assetLabel = Instance.new(&quot;TextLabel&quot;)
	assetLabel.Text = &quot;Your Asset Here&quot;
	assetLabel.Position = UDim2.new(0.0, 0, 0.0, 0)
	assetLabel.Size = UDim2.new(1.0, 0, 1.0, -height)
	assetLabel.BorderSizePixel = 0
	assetLabel.BackgroundTransparency = 1.0
	assetLabel.Parent = descriptionFrame
	assetLabel.TextColor3 = frameTextColor
	assetLabel.TextWrap = true
	Window.Stamp.AssetNameLabel = assetLabel	

	local cancelButton = Instance.new(&quot;TextButton&quot;)
	cancelButton.Name = &quot;CancelButton&quot;
	cancelButton.Size = UDim2.new(0, height*4.5, 0, height)
	cancelButton.Position = UDim2.new(0.5, -height*2.25, 1.0, -height*1.2)
	cancelButton.BackgroundColor3 = buttonColor
	cancelButton.TextColor3 = buttonTextColor
	cancelButton.Text = &quot;Back to Toolbox&quot;
	cancelButton.MouseButton1Click:connect(cancelAssetPlacement)
	cancelButton.Parent = descriptionFrame

	Data.Stamp.MovingLock = false	
end

function buildInitialLoadScreen(root)
	local dialogFrame = Instance.new(&quot;Frame&quot;)
	dialogFrame.Name = &quot;InsertLoadingScreen&quot;
	dialogFrame.Size = UDim2.new(0.0, height*10, 0, height*5)
	dialogFrame.Position = UDim2.new(0.5, -height*5, 0.5, -height*2.5)
	dialogFrame.BackgroundColor3 = frameColor
	dialogFrame.Active = true
	dialogFrame.Visible = true
	dialogFrame.Parent = root

	local label = Instance.new(&quot;TextLabel&quot;)
	label.Text = &quot;Loading&quot;
	label.Position = UDim2.new(0.0, 0, 0, 0)
	label.Size = UDim2.new(1.0, 0, 0.0, height)
	label.BorderSizePixel = 1
	label.TextColor3 = titleTextColor
	label.BackgroundColor3 = titleColor
	label.Parent = dialogFrame
	
	local assetLabel = Instance.new(&quot;TextLabel&quot;)
	assetLabel.Text = &quot;Please Wait&quot;
	assetLabel.Position = UDim2.new(0.0, 0, 0.0, height)
	assetLabel.Size = UDim2.new(1.0, 0, 1.0, -2*height)
	assetLabel.BorderSizePixel = 1
	assetLabel.BackgroundTransparency = 1.0
	assetLabel.TextColor3 = frameTextColor
	assetLabel.TextWrap = true
	assetLabel.Parent = dialogFrame
end

function buildMinimizedGui(root)
	Window.Minimized = {}
	Data.Minimized = {}
	local minimizeButton = Instance.new(&quot;TextButton&quot;)
	minimizeButton.Name = &quot;MinimizeButton&quot;
	minimizeButton.Size = UDim2.new(0, height*4.5, 0, height)
	minimizeButton.Position = UDim2.new(0.0, 0, 1.0, -height)
	minimizeButton.BackgroundColor3 = buttonColor
	minimizeButton.TextColor3 = buttonTextColor
	minimizeButton.Text = &quot;Toolbox&quot;
	minimizeButton.MouseButton1Click:connect(function() Window.Minimized.Frame.Visible = false Window.Main.Frame.Visible = true end)
	minimizeButton.Visible = false
	minimizeButton.Parent = root

	Window.Minimized.Frame = minimizeButton
end


local CancelDuringLoad
local LoadScreen 
function onEquippedLocal(mouse)
	Tool.TextureId = &quot;rbxasset://icons/insert_sel.png&quot;

	Mouse = mouse
	if Tool.SavedState.Value and Tool.PlayerOwner.Value == getPlayer() and Data and Data.FullyLoaded then
		guiMain = Tool.SavedState.Value
		guiMain.Parent = getPlayer().PlayerGui

		Window.Stamp.Frame.Visible = false
		Window.Minimized.Frame.Visible = false
		Window.Loading.Frame.Visible = false
		Window.Main.Frame.Visible = true
		
		--Window = Tool.SavedState.Value.Window
		--Data = Tool.SavedState.Value.Window
	else
		CancelDuringLoad = false

		LoadScreen = Instance.new(&quot;ScreenGui&quot;)
		LoadScreen.Name = &quot;InsertToolLoading&quot;
		buildInitialLoadScreen(LoadScreen)
		LoadScreen.Parent = getPlayer().PlayerGui
		
		guiMain = Instance.new(&quot;ScreenGui&quot;)
		guiMain.Name = &quot;InsertToolboxMain&quot;
		Window = {}
		Data = {}
		Data.FullyLoaded = false

		buildMainGui(guiMain, getPlayer().userId)
		buildLoadingDialogGui(guiMain)
		buildStampDialogGui(guiMain)
		buildMinimizedGui(guiMain)

		LoadScreen:Remove()
		LoadScreen = nil
		
		if not(CancelDuringLoad) then
			guiMain.Changed:connect(function(property) if property == &quot;AbsoluteSize&quot; then layoutInsertButtons(guiMain) end end)
			guiMain.Parent = getPlayer().PlayerGui

			Tool.SavedState.Value = guiMain
			Tool.PlayerOwner.Value = getPlayer()
		end

		Data.FullyLoaded = true
	end

	Mouse.Move:connect(onInsertMouseMove)
	Mouse.Button1Down:connect(onInsertMouseButton1Down)
	Mouse.Button1Up:connect(onInsertMouseButton1Up)
	Mouse.KeyDown:connect(onInsertKeyDown)

end

function onUnequippedLocal()
	Tool.TextureId = origTexture

	pcall(function()
		cancelAssetPlacement()
		cancelAssetLoad()
		guiMain.Parent = nil
		end)
	
	CancelDuringLoad = true

	if LoadScreen then
		LoadScreen:Remove()
	end
end

function onAncestryChanged(child,parent)
	if Tool.PlayerOwner.Value and not Tool:IsDescendantOf(Tool.PlayerOwner.Value) and not Tool:IsDescendantOf(Tool.PlayerOwner.Value.Character) then
		--Tool was dropped in some way, so we need to nuke our external state
		Tool.SavedState.Value = nil
		Tool.PlayerOwner.Value = nil
	end
	
	pcall(cancelAssetPlacement)
	pcall(cancelAssetLoad)
end


Tool.Equipped:connect(onEquippedLocal)
Tool.Unequipped:connect(onUnequippedLocal)
Tool.AncestryChanged:connect(onAncestryChanged)</ProtectedString>
					<bool name="archivable">true</bool>
				</Properties>
			</Item>
			<Item class="ObjectValue" referent="RBX16">
				<Properties>
					<string name="Name">SavedState</string>
					<Ref name="Value">null</Ref>
					<bool name="archivable">true</bool>
				</Properties>
			</Item>
			<Item class="Part" referent="RBX17">
				<Properties>
					<bool name="Anchored">false</bool>
					<float name="BackParamA">-0.5</float>
					<float name="BackParamB">0.5</float>
					<token name="BackSurface">0</token>
					<token name="BackSurfaceInput">0</token>
					<float name="BottomParamA">-0.5</float>
					<float name="BottomParamB">0.5</float>
					<token name="BottomSurface">0</token>
					<token name="BottomSurfaceInput">0</token>
					<int name="BrickColor">199</int>
					<CoordinateFrame name="CFrame">
						<X>-53.725769</X>
						<Y>4.3984623</Y>
						<Z>67.9757538</Z>
						<R00>0.264595449</R00>
						<R01>-0.000210692568</R01>
						<R02>-0.964359581</R02>
						<R10>0.000796274224</R10>
						<R11>0.999999642</R11>
						<R12>-2.03719996e-009</R12>
						<R20>0.964359343</R20>
						<R21>-0.000767894206</R21>
						<R22>0.264595509</R22>
					</CoordinateFrame>
					<bool name="CanCollide">true</bool>
					<bool name="DraggingV1">false</bool>
					<float name="Elasticity">0.5</float>
					<token name="FormFactor">2</token>
					<float name="Friction">0.300000012</float>
					<float name="FrontParamA">-0.5</float>
					<float name="FrontParamB">0.5</float>
					<token name="FrontSurface">0</token>
					<token name="FrontSurfaceInput">0</token>
					<float name="LeftParamA">-0.5</float>
					<float name="LeftParamB">0.5</float>
					<token name="LeftSurface">0</token>
					<token name="LeftSurfaceInput">0</token>
					<bool name="Locked">false</bool>
					<token name="Material">256</token>
					<string name="Name">Handle</string>
					<float name="Reflectance">0</float>
					<float name="RightParamA">-0.5</float>
					<float name="RightParamB">0.5</float>
					<token name="RightSurface">0</token>
					<token name="RightSurfaceInput">0</token>
					<Vector3 name="RotVelocity">
						<X>0</X>
						<Y>0</Y>
						<Z>0</Z>
					</Vector3>
					<float name="TopParamA">-0.5</float>
					<float name="TopParamB">0.5</float>
					<token name="TopSurface">0</token>
					<token name="TopSurfaceInput">0</token>
					<float name="Transparency">0</float>
					<Vector3 name="Velocity">
						<X>0</X>
						<Y>0</Y>
						<Z>0</Z>
					</Vector3>
					<bool name="archivable">true</bool>
					<token name="shape">1</token>
					<Vector3 name="size">
						<X>1</X>
						<Y>0.800000012</Y>
						<Z>2</Z>
					</Vector3>
				</Properties>
				<Item class="SpecialMesh" referent="RBX18">
					<Properties>
						<token name="LODX">2</token>
						<token name="LODY">2</token>
						<Content name="MeshId"><url>http://www.roblox.com/asset/?id=18715644</url></Content>
						<token name="MeshType">5</token>
						<string name="Name">Mesh</string>
						<Vector3 name="Offset">
							<X>0</X>
							<Y>0</Y>
							<Z>0</Z>
						</Vector3>
						<Vector3 name="Scale">
							<X>0.899999976</X>
							<Y>0.899999976</Y>
							<Z>0.899999976</Z>
						</Vector3>
						<Content name="TextureId"><url>http://www.roblox.com/asset/?id=18715636</url></Content>
						<Vector3 name="VertexColor">
							<X>1</X>
							<Y>1</Y>
							<Z>1</Z>
						</Vector3>
						<bool name="archivable">true</bool>
					</Properties>
				</Item>
			</Item>
			<Item class="ObjectValue" referent="RBX19">
				<Properties>
					<string name="Name">PlayerOwner</string>
					<Ref name="Value">null</Ref>
					<bool name="archivable">true</bool>
				</Properties>
			</Item>
		</Item>
	</Item>
	<Item class="StarterGui" referent="RBX20">
		<Properties>
			<string name="Name">StarterGui</string>
			<bool name="ShowDevelopmentGui">true</bool>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="SoundService" referent="RBX21">
		<Properties>
			<token name="AmbientReverb">0</token>
			<float name="DistanceFactor">10</float>
			<float name="DopplerScale">1</float>
			<string name="Name">Soundscape</string>
			<float name="RolloffScale">1</float>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="CollectionService" referent="RBX22">
		<Properties>
			<string name="Name">CollectionService</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="PhysicsService" referent="RBX23">
		<Properties>
			<string name="Name">PhysicsService</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="BadgeService" referent="RBX24">
		<Properties>
			<string name="Name">BadgeService</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="Geometry" referent="RBX25">
		<Properties>
			<string name="Name">Geometry</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="SocialService" referent="RBX26">
		<Properties>
			<string name="Name">SocialService</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="Debris" referent="RBX27">
		<Properties>
			<int name="MaxItems">1000</int>
			<string name="Name">Debris</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="Timer" referent="RBX28">
		<Properties>
			<string name="Name">Instance</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="ScriptInformationProvider" referent="RBX29">
		<Properties>
			<string name="Name">Instance</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="Selection" referent="RBX30">
		<Properties>
			<string name="Name">Selection</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="MeshContentProvider" referent="RBX31">
		<Properties>
			<string name="Name">Instance</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="TextureContentProvider" referent="RBX32">
		<Properties>
			<string name="Name">Instance</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="Lighting" referent="RBX33">
		<Properties>
			<Color3 name="Ambient">4286611584</Color3>
			<float name="Brightness">1</float>
			<Color3 name="ColorShift_Bottom">4278190080</Color3>
			<Color3 name="ColorShift_Top">4278190080</Color3>
			<float name="GeographicLatitude">41.7332993</float>
			<string name="Name">Lighting</string>
			<Color3 name="ShadowColor">4289967032</Color3>
			<string name="TimeOfDay">14:00:00</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
	<Item class="ChangeHistoryService" referent="RBX34">
		<Properties>
			<string name="Name">ChangeHistoryService</string>
			<bool name="archivable">true</bool>
		</Properties>
	</Item>
</roblox>